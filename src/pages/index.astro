---
import BlogCard from '@/components/BlogCard.astro'
import Link from '@/components/Link.astro'
import PageHead from '@/components/PageHead.astro'
import { buttonVariants } from '@/components/ui/button'
import { SITE } from '@/consts'
import Layout from '@/layouts/Layout.astro'
import { getRecentPosts } from '@/lib/data-utils'
import { Icon } from 'astro-icon/components'

// Error handling for fetching recent posts
let latestPosts: Awaited<ReturnType<typeof getRecentPosts>> = []
try {
	latestPosts = await getRecentPosts(3)
} catch (error) {
	console.error('Error fetching recent posts:', error)
}
---

<Layout class="max-w-3xl" transition:persist="home-layout">
	<PageHead slot="head" title={SITE.title} fullTitle={true} />

	<!-- Latest from the blog -->
	{
		latestPosts && latestPosts.length > 0 && (
			<section class="mt-12">
				<div class="mb-6 flex items-center justify-between">
					<div>
						<h2 class="mb-2 text-2xl font-semibold">Latest News</h2>
						<p class="text-muted-foreground text-sm">
							Recent insights and articles
						</p>
					</div>
					<Link
						href="/blog"
						class={
							buttonVariants({ variant: 'ghost' }) +
							' hidden items-center gap-1.5 sm:flex'
						}
					>
						View all
						<Icon name="lucide:arrow-right" class="size-4" />
					</Link>
				</div>

				<div class="bg-border/30 h-px" aria-hidden="true" />

				<div class="space-y-2">
					{latestPosts.map((post) => (
						<article>
							<BlogCard entry={post} />
						</article>
					))}
				</div>

				<article class="mt-2 sm:hidden">
					<Link
						href="/blog"
						aria-label="View all blog posts"
						class="group border-border/50 bg-muted/20 hover:bg-muted/40 hover:border-primary/30 block rounded-md border px-2 py-3 transition-all duration-200"
					>
						<div class="flex items-center gap-3">
							<div
								class="bg-primary/10 dark:bg-primary/20 group-hover:bg-primary/20 dark:group-hover:bg-primary/30 flex h-10 w-10 shrink-0 items-center justify-center rounded-lg transition-colors"
								aria-hidden="true"
							>
								<Icon name="lucide:library" class="text-primary size-5" />
							</div>
							<div class="min-w-0 flex-1">
								<div class="flex items-center gap-2">
									<span class="text-foreground group-hover:text-primary text-sm font-semibold transition-colors">
										View all posts
									</span>
									<Icon
										name="lucide:arrow-right"
										class="text-primary/70 group-hover:text-primary size-4 shrink-0 transition-all group-hover:translate-x-0.5"
										aria-hidden="true"
									/>
								</div>
								<p class="text-muted-foreground mt-0.5 text-xs">
									Explore all articles and tutorials
								</p>
							</div>
						</div>
					</Link>
				</article>
			</section>
		)
	}
</Layout>
